{% extends "base.html" %}
{% block content %}
<section class="card">
  <div class="banner red">
    <p class="kicker">Resultado de diagnóstico</p>
    <h1>{{ ranking[0][0] }}</h1>
  </div>

  <div class="grid2">
    <div>
      <div class="stat">
        <div class="stat-row"><span>Probabilidad principal</span><span class="strong" id="p0">{{ ranking[0][1] }}%</span></div>
        <div class="bar"><span id="bar0" style="width: 0%"></span></div>
      </div>

      <div class="muted">
        Paciente: {{ nombre }} · Edad: {{ edad }} · ID: {{ identidad }}<br/>
        {% if antecedentes %}Antecedentes: {{ antecedentes }}{% endif %}
      </div>

      <div class="badge triage {{ nivel|lower }}">Nivel de prioridad: {{ nivel }}</div>
      <p class="muted">{{ mensaje_triaje }}</p>

      <details class="expander">
        <summary>Síntomas considerados (click para ver)</summary>
        <ul class="muted">
          {% for s in seleccionados %}<li>{{ s }}</li>{% endfor %}
        </ul>
      </details>
    </div>

    <div>
      <div class="stat">
        <div class="stat-row"><span>Alternativas</span></div>
        <div class="alt">
          <div class="alt-row"><span>{{ ranking[1][0] }}</span><span class="strong" id="p1">{{ ranking[1][1] }}%</span></div>
          <div class="bar sm"><span id="bar1" style="width: 0%"></span></div>
        </div>
        <div class="alt">
          <div class="alt-row"><span>{{ ranking[2][0] }}</span><span class="strong" id="p2">{{ ranking[2][1] }}%</span></div>
          <div class="bar sm"><span id="bar2" style="width: 0%"></span></div>
        </div>
      </div>

      <div class="tips">
        <h3>Recomendaciones</h3>
        <ul>
          <li>Hidratación y control de temperatura si hay fiebre.</li>
          <li>Consulta si aparecen señales de alarma (dolor torácico, dificultad respiratoria, desorientación).</li>
          <li>Monitoreo en 24–48 h y seguimiento con personal de salud.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="right actions-gap">
    <button class="btn ghost" onclick="window.print()">Guardar/Imprimir reporte</button>
    <a class="btn danger" href="{{ url_for('logout') }}">Salir</a>
  </div>

  <script>
    // Animación sencilla de barras
    function animateBar(id, target){
      const el = document.getElementById(id);
      let w = 0;
      const step = () => {
        w += 2;
        if(w >= target) w = target;
        el.style.width = w + '%';
        if(w < target) requestAnimationFrame(step);
      };
      requestAnimationFrame(step);
    }
    animateBar('bar0', {{ ranking[0][1] }});
    animateBar('bar1', {{ ranking[1][1] }});
    animateBar('bar2', {{ ranking[2][1] }});
  </script>

  <div class="left actions-gap" style="padding: 0 16px 12px 16px;">
    <button class="btn ghost" onclick="history.back()">Retroceder</button>
  </div>

  <div class="credits-block center" style="padding: 8px 16px 16px; color:#5b6175;">
    <small>By: Ing. Emilio Regalado & Angel Tocto</small>
  </div>
</section>

{% endblock %}
